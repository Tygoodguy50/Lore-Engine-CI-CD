# Bazel configuration for LocalAI

# Disable CGO completely to avoid C++ toolchain issues
build --action_env=CGO_ENABLED=0

# Disable C++ toolchain resolution to avoid Windows SDK issues
build --incompatible_enable_cc_toolchain_resolution=false

# Additional flags to disable C++ toolchain usage
build --strategy=GoCompile=standalone
build --strategy=GoLink=standalone

# Enable Bzlmod
common --enable_bzlmod

# Improve build performance
build --jobs=auto
build --local_resources=memory=HOST_RAM*0.75
build --local_resources=cpu=HOST_CPUS*0.75

# Show detailed error messages
build --verbose_failures

# Release configuration for production builds
build:release --compilation_mode=opt
build:release --strip=always
build:release --copt=-O3
build:release --copt=-DNDEBUG
build:release --linkopt=-s
build:release --action_env=CGO_ENABLED=0

# Debug configuration
build:debug --compilation_mode=dbg
build:debug --strip=never
build:debug --copt=-g

# Test configuration
test --test_output=errors
test --test_summary=detailed
test --test_verbose_timeout_warnings

# CI-specific configuration
build:ci --action_env=CGO_ENABLED=0
build:ci --compilation_mode=opt
